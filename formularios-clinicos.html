<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Formularios Cl√≠nicos | Figura Rostro KG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <style>
    :root{
      --bg:#f5f0ff;
      --card:#ffffff;
      --brand:#5b2580;
      --brand-soft:#8a4cc4;
      --text:#1f1230;
      --border:#e0d2f5;
      --danger:#d93025;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:var(--bg);
      color:var(--text);
      overscroll-behavior: none; /* Evita rebotes en iOS */
    }

    .page{
      max-width:1100px;
      margin:0 auto;
      padding:20px 16px 50px;
    }

    header{ text-align:center; margin-bottom:20px; }
    header h1{ margin:8px 0 4px; font-size:1.6rem; color:var(--brand); }
    header p{ margin:0; font-size:0.9rem; color:#5b5470; }

    /* TABS */
    .tabs{ display:flex; gap:10px; margin:20px 0 16px; justify-content:center; }
    .tab-btn{
      border:1px solid var(--brand-soft); background:#fff; color:var(--brand);
      padding:10px 24px; border-radius:999px; font-size:1rem; font-weight: 500;
      cursor:pointer; transition:.2s;
    }
    .tab-btn.active{ background:var(--brand); color:#fff; box-shadow: 0 4px 12px rgba(91, 37, 128, 0.3); }

    /* FORM WRAPPER */
    .forms-wrapper{
      background:var(--card); border-radius:16px; border:1px solid var(--border);
      padding:20px; box-shadow:0 8px 20px rgba(43,7,88,.07);
    }
    form{ display:none; }
    form.active{ display:block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    h2{ font-size:1.3rem; margin:0 0 15px; color:var(--brand); border-bottom: 2px solid var(--border); padding-bottom: 8px; }
    h3{ font-size:1.05rem; margin:24px 0 8px; color:var(--brand-soft); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    label{ font-size:0.9rem; display:block; margin-bottom:4px; font-weight:600; color: #444; }

    /* INPUTS */
    .field-row{ display:flex; gap:12px; flex-wrap:wrap; }
    .field{ flex:1 1 180px; margin-bottom:10px; }
    
    input[type="text"], input[type="email"], input[type="tel"], input[type="date"], input[type="number"], select, textarea{
      width:100%; padding:8px 10px; border-radius:6px; border:1px solid var(--border);
      font-size:0.95rem; background: #fcfaff;
    }
    textarea{ min-height:60px; resize:vertical; }
    input:focus, select:focus, textarea:focus { border-color: var(--brand); outline: none; background: #fff; }

    /* CHECKBOXES & LISTS */
    .check-group{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
      gap:6px 10px; margin-bottom:12px; background: #faf8fd; padding: 10px; border-radius: 8px; border: 1px solid #f0e6fa;
    }
    .check-item{ display:flex; align-items:flex-start; gap:8px; cursor: pointer; font-size:0.85rem; font-weight: 400; color: #333; }
    .check-item input{ margin-top:3px; accent-color: var(--brand); transform: scale(1.1); }

    /* SECTIONS */
    .section-divider{ border-top:1px dashed var(--border); margin:24px 0; }

    /* FIRMA DIGITAL */
    .signature-container {
      margin-top: 15px;
      border: 2px dashed var(--brand-soft);
      background: #fff;
      border-radius: 8px;
      position: relative;
      touch-action: none; /* CRITICO PARA TABLET */
    }
    canvas {
      width: 100%;
      height: 130px; /* Altura reducida como pediste */
      display: block;
      cursor: crosshair;
    }
    .sig-footer {
      background: #f4f4f4; border-top: 1px solid #ddd; padding: 4px 10px;
      display: flex; justify-content: flex-end; border-radius: 0 0 8px 8px;
    }
    .btn-small {
      background: #fff; border: 1px solid #999; font-size: 0.75rem;
      padding: 3px 8px; border-radius: 4px; cursor: pointer; color: #555;
    }

    /* CONSENTIMIENTO */
    .consent-box{
      background:#f8f5fc; padding:15px; border-radius:10px; border:1px solid var(--border);
      font-size:0.85rem; line-height:1.4; color: #444;
    }
    .consent-title{ color: var(--brand); font-weight: 700; margin-bottom: 5px; }
    .consent-list{ padding-left: 15px; margin: 5px 0; }

    /* BOTONES */
    .actions{ display:flex; gap:10px; margin-top:20px; flex-wrap:wrap; }
    .btn{
      border:none; border-radius:999px; padding:12px 24px; font-size:0.95rem; font-weight:600;
      cursor:pointer; display:flex; align-items:center; gap:8px; flex: 1; justify-content: center;
    }
    .btn-primary{ background:var(--brand); color:#fff; }
    .btn-ghost{ background:#fff; color:var(--brand); border:1px solid var(--brand); }

    @media (max-width:600px){ .forms-wrapper{ padding:12px; } .btn{ flex: 100%; } }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Formularios Cl√≠nicos ‚Äì Figura Rostro KG</h1>
      <p>Historial Cl√≠nico Digital y Consentimiento</p>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-target="facial-form">Ficha Facial</button>
      <button class="tab-btn" data-target="corporal-form">Ficha Corporal</button>
    </div>

    <div class="forms-wrapper">
      
      <form id="facial-form" class="active" action="https://formsubmit.co/figurarostro25@gmail.com" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="_next" value="https://figurarostro.life">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_subject" value="Ficha FACIAL Completa - Figura Rostro">
        <input type="hidden" name="signature_data" id="sig-data-facial">

        <h2>Ficha T√©cnica Facial</h2>

        <h3>1. Datos del Cliente</h3>
        <div class="field-row">
          <div class="field"><label>Nombre completo</label><input type="text" name="facial_nombre" required></div>
          <div class="field"><label>Edad</label><input type="number" name="facial_edad"></div>
          <div class="field"><label>Sexo</label><input type="text" name="facial_sexo" placeholder="F / M"></div>
        </div>
        <div class="field-row">
          <div class="field"><label>Tel√©fono</label><input type="tel" name="facial_telefono"></div>
          <div class="field"><label>Correo</label><input type="email" name="facial_correo"></div>
        </div>
        <div class="field-row">
          <div class="field"><label>Direcci√≥n</label><input type="text" name="facial_direccion"></div>
          <div class="field"><label>Fecha</label><input type="date" name="facial_fecha" id="date-facial"></div>
        </div>

        <h3>2. Tratamiento Solicitado</h3>
        
        <label>Limpiezas y Peelings</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Limpieza Profunda"> Limpieza Profunda</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Limpieza Premium"> Limpieza Premium</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Dermaplaning"> Dermaplaning</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Peeling Qu√≠mico"> Peeling Qu√≠mico</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Peeling Hollywood"> Peeling Hollywood</label>
        </div>

        <label>Rejuvenecimiento y Plasma</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Radiofrecuencia"> Radiofrecuencia</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Alta Frecuencia"> Alta Frecuencia</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Plasma Lifting P√°rpados"> Plasma (P√°rpados)</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Plasma Manchas/Verrugas"> Plasma (Manchas/Verrugas)</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Dermapen"> Dermapen / Microneedling</label>
        </div>

        <label>Cejas, Pesta√±as y Labios</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Dise√±o Cejas"> Dise√±o Cejas</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Micropigmentaci√≥n"> Micropigmentaci√≥n</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Lifting Pesta√±as"> Lifting Pesta√±as</label>
          <label class="check-item"><input type="checkbox" name="facial_servicios[]" value="Hidralix Labios"> Hidralix Labios</label>
        </div>

        <h3>3. Evaluaci√≥n T√©cnica</h3>
        <div class="field-row">
          <div class="field"><label>Tipo de Piel</label><input type="text" name="facial_piel" placeholder="Grasa, Mixta, Seca..."></div>
          <div class="field"><label>Sensibilidad</label><select name="facial_sensibilidad"><option>Baja</option><option>Media</option><option>Alta</option></select></div>
        </div>
        <div class="field">
          <label>Condiciones Observadas</label>
          <textarea name="facial_condiciones" placeholder="Acn√©, manchas, poros abiertos, l√≠neas de expresi√≥n, cicatrices..."></textarea>
        </div>

        <h3>4. Historial M√©dico</h3>
        <div class="field-row">
          <div class="field"><label>Alergias</label><input type="text" name="facial_alergias"></div>
          <div class="field"><label>Medicamentos</label><input type="text" name="facial_medicamentos"></div>
        </div>
        <div class="field-row">
          <div class="field"><label>Cirug√≠as Recientes</label><input type="text" name="facial_cirugias"></div>
          <div class="field"><label>Tratamientos Previos</label><input type="text" name="facial_previos"></div>
        </div>
        <div class="field-row">
          <div class="field"><label>Tensi√≥n Arterial</label><input type="text" name="facial_tension"></div>
          <div class="field"><label>Frecuencia Card√≠aca</label><input type="text" name="facial_fc"></div>
        </div>

        <h3>5. Recomendaci√≥n Profesional</h3>
        <div class="field"><textarea name="facial_recomendacion" placeholder="Protocolo a seguir y recomendaciones de casa..."></textarea></div>

        <div class="section-divider"></div>
        <div class="consent-box">
          <div class="consent-title">Consentimiento y Firma</div>
          <p>Confirmo que la informaci√≥n es ver√≠dica. Autorizo el procedimiento y entiendo los cuidados posteriores.</p>
          <label style="margin-top:10px; font-weight:700; color:#5b2580;">Firma del Cliente:</label>
          
          <div class="signature-container">
            <canvas id="canvas-facial"></canvas>
            <div class="sig-footer">
              <button type="button" class="btn-small" onclick="clearSig('facial')">Borrar y firmar de nuevo</button>
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary" onclick="saveSig('facial')">Enviar Ficha</button>
          <button type="button" class="btn btn-ghost" onclick="printForm('facial')">üìÑ Imprimir PDF</button>
        </div>
      </form>

      <form id="corporal-form" action="https://formsubmit.co/figurarostro25@gmail.com" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="_next" value="https://figurarostro.life">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_subject" value="Ficha CORPORAL Completa - Figura Rostro">
        <input type="hidden" name="signature_data" id="sig-data-corp">

        <h2>Ficha T√©cnica Corporal</h2>

        <h3>1. Datos del Cliente</h3>
        <div class="field-row">
          <div class="field"><label>Nombre completo</label><input type="text" name="corp_nombre" required></div>
          <div class="field"><label>Edad</label><input type="number" name="corp_edad"></div>
          <div class="field"><label>Sexo</label><input type="text" name="corp_sexo" placeholder="F / M"></div>
        </div>
        <div class="field-row">
          <div class="field"><label>Tel√©fono</label><input type="tel" name="corp_telefono"></div>
          <div class="field"><label>Fecha</label><input type="date" name="corp_fecha" id="date-corp"></div>
        </div>

        <h3>2. Tratamientos Solicitados</h3>
        
        <label>Reducci√≥n y Moldeamiento</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Masaje Reductor"> Masaje Reductor</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Masaje Moldeador"> Masaje Moldeador</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Maderoterapia"> Maderoterapia</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Anticelulitis"> Tratamiento Anticelulitis</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Aparatologia"> Aparatolog√≠a (Cavitaci√≥n/RF)</label>
        </div>

        <label>Drenaje y Post-Operatorio</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Drenaje Linfatico"> Drenaje Linf√°tico</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Post-Operatorio"> Post-Operatorio</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Piernas Cansadas"> Piernas Cansadas / Edemas</label>
        </div>

        <label>Relajaci√≥n y Terap√©utico</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Masaje Relajante"> Masaje Relajante</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Descontracturante"> Descontracturante</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Reflexologia"> Reflexolog√≠a</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Lumbar/Cervical"> Dolor Lumbar / Cervical</label>
        </div>
        
        <label>Depilaci√≥n</label>
        <div class="check-group">
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Cera Cuerpo"> Depilaci√≥n Cera (Cuerpo)</label>
          <label class="check-item"><input type="checkbox" name="corp_servicios[]" value="Cera Zonas Intimas"> Depilaci√≥n Zonas √çntimas</label>
        </div>

        <h3>3. Seguridad y Estilo de Vida</h3>
        <p style="font-size:0.85rem; color:#d93025; margin-bottom:5px;">*Obligatorio: Marque si aplica alguna condici√≥n.</p>
        <div class="check-group" style="background:#fff0f0; border-color:#fadbd8;">
          <label class="check-item"><input type="checkbox" name="corp_medico[]" value="Marcapasos"> <b>Marcapasos</b></label>
          <label class="check-item"><input type="checkbox" name="corp_medico[]" value="Implantes Metalicos"> <b>Implantes Met√°licos</b></label>
          <label class="check-item"><input type="checkbox" name="corp_medico[]" value="DIU"> <b>DIU (T de Cobre)</b></label>
          <label class="check-item"><input type="checkbox" name="corp_medico[]" value="Embarazo"> <b>Posible Embarazo</b></label>
          <label class="check-item"><input type="checkbox" name="corp_medico[]" value="Hipertension"> Hipertensi√≥n</label>
          <label class="check-item"><input type="checkbox" name="corp_medico[]" value="Diabetes"> Diabetes</label>
        </div>

        <div class="field-row">
          <div class="field"><label>Consumo de Agua</label><select name="corp_agua"><option>Menos de 1L</option><option>1 a 2L</option><option>M√°s de 2L</option></select></div>
          <div class="field"><label>Actividad F√≠sica</label><select name="corp_actividad"><option>Sedentario</option><option>Ligera</option><option>Moderada</option><option>Intensa</option></select></div>
          <div class="field"><label>Digesti√≥n</label><select name="corp_digestion"><option>Normal</option><option>Estre√±imiento</option></select></div>
        </div>

        <h3>4. Historial M√©dico General</h3>
        <div class="field-row">
          <div class="field"><label>Alergias</label><input type="text" name="corp_alergias"></div>
          <div class="field"><label>Cirug√≠as Previas</label><input type="text" name="corp_cirugias"></div>
        </div>
        <div class="field"><label>Medicamentos / Enfermedades</label><input type="text" name="corp_medicamentos"></div>
        <div class="field-row">
          <div class="field"><label>Tensi√≥n Arterial</label><input type="text" name="corp_tension"></div>
          <div class="field"><label>Frecuencia Card√≠aca</label><input type="text" name="corp_fc"></div>
        </div>

        <h3>5. Evaluaci√≥n Corporal</h3>
        <div class="field"><label>Zonas a Tratar</label><textarea name="corp_zonas" placeholder="Abdomen, cintura, espalda, brazos..."></textarea></div>
        <div class="field"><label>Diagn√≥stico Est√©tico</label><textarea name="corp_diagnostico" placeholder="Adiposidad, celulitis, flacidez, fibrosis..."></textarea></div>
        <div class="field"><label>Puntos de Tensi√≥n / Dolor</label><textarea name="corp_dolor" placeholder="Nivel de dolor muscular y ubicaci√≥n..."></textarea></div>

        <h3>6. Protocolo Recomendado</h3>
        <div class="field"><textarea name="corp_recomendacion" placeholder="Paquete sugerido y n√∫mero de sesiones..."></textarea></div>

        <div class="section-divider"></div>
        <div class="consent-box">
          <div class="consent-title">Consentimiento y Firma</div>
          <p>Confirmo que he informado sobre implantes, DIU o condiciones m√©dicas. Acepto el tratamiento bajo mi responsabilidad.</p>
          <label style="margin-top:10px; font-weight:700; color:#5b2580;">Firma del Cliente:</label>
          
          <div class="signature-container">
            <canvas id="canvas-corp"></canvas>
            <div class="sig-footer">
              <button type="button" class="btn-small" onclick="clearSig('corp')">Borrar y firmar de nuevo</button>
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary" onclick="saveSig('corp')">Enviar Ficha</button>
          <button type="button" class="btn btn-ghost" onclick="printForm('corporal')">üìÑ Imprimir PDF</button>
        </div>
      </form>

    </div>
  </div>

  <script>
    // --- INICIALIZACI√ìN ---
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date-facial').value = today;
    document.getElementById('date-corp').value = today;

    // --- PESTA√ëAS (TABS) ---
    const tabs = document.querySelectorAll('.tab-btn');
    const forms = document.querySelectorAll('form');

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        forms.forEach(f => f.classList.remove('active'));
        const targetId = btn.dataset.target;
        document.getElementById(targetId).classList.add('active');
        
        // Ajustar canvas al cambiar de pesta√±a para evitar errores visuales
        resizeCanvas(document.getElementById(targetId === 'facial-form' ? 'canvas-facial' : 'canvas-corp'));
      });
    });

    // --- L√ìGICA DE FIRMA (CANVAS) ---
    function initCanvas(id) {
      const canvas = document.getElementById(id);
      const ctx = canvas.getContext('2d');
      let drawing = false;

      // Ajustar tama√±o real
      const resize = () => {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
      };
      window.addEventListener('resize', resize);
      setTimeout(resize, 100); // init delay

      // Eventos Mouse
      const startDraw = (e) => { drawing = true; ctx.beginPath(); draw(e); };
      const endDraw = () => { drawing = false; ctx.beginPath(); };
      const draw = (e) => {
        if (!drawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      };

      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('mouseup', endDraw);
      canvas.addEventListener('mousemove', draw);

      // Eventos Touch (Tablet)
      canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, {passive: false});
      canvas.addEventListener('touchend', endDraw);
      canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, {passive: false});
    }

    // Inicializar ambos canvas
    initCanvas('canvas-facial');
    initCanvas('canvas-corp');

    function resizeCanvas(canvas){
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
    }

    function clearSig(type) {
      const canvas = document.getElementById(type === 'facial' ? 'canvas-facial' : 'canvas-corp');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function saveSig(type) {
      const canvas = document.getElementById(type === 'facial' ? 'canvas-facial' : 'canvas-corp');
      const input = document.getElementById(type === 'facial' ? 'sig-data-facial' : 'sig-data-corp');
      // Solo guardar si hay algo dibujado (opcional, aqu√≠ guarda siempre)
      input.value = canvas.toDataURL('image/png');
    }

    // --- GENERAR PDF / IMPRIMIR (CON TODOS LOS DATOS) ---
    function printForm(type) {
      const form = document.getElementById(type + '-form');
      const data = new FormData(form);
      const canvas = document.getElementById(type === 'facial' ? 'canvas-facial' : 'canvas-corp');
      const sigImg = canvas.toDataURL('image/png');
      
      let win = window.open('', '_blank');
      let title = type === 'facial' ? 'Ficha Cl√≠nica Facial' : 'Ficha Cl√≠nica Corporal';
      
      // Funci√≥n para obtener checkboxes marcados
      const getChecks = (name) => {
        const checks = data.getAll(name);
        return checks.length > 0 ? checks.join(', ') : 'Ninguno';
      };

      let content = '';
      if(type === 'facial') {
        content = `
          <h3>2. Tratamientos</h3>
          <p><b>Servicios:</b> ${getChecks('facial_servicios[]')}</p>
          <h3>3. Evaluaci√≥n</h3>
          <p><b>Piel:</b> ${data.get('facial_piel')} | <b>Sensibilidad:</b> ${data.get('facial_sensibilidad')}</p>
          <p><b>Condiciones:</b> ${data.get('facial_condiciones')}</p>
          <h3>4. Historial M√©dico</h3>
          <p><b>Alergias:</b> ${data.get('facial_alergias')}</p>
          <p><b>Medicamentos:</b> ${data.get('facial_medicamentos')}</p>
          <p><b>Cirug√≠as/Previos:</b> ${data.get('facial_cirugias')} / ${data.get('facial_previos')}</p>
          <p><b>Tensi√≥n:</b> ${data.get('facial_tension')} | <b>FC:</b> ${data.get('facial_fc')}</p>
          <h3>5. Recomendaci√≥n</h3>
          <p>${data.get('facial_recomendacion')}</p>
        `;
      } else {
        content = `
          <h3>2. Tratamientos</h3>
          <p><b>Servicios:</b> ${getChecks('corp_servicios[]')}</p>
          <h3 style="color:#d93025">3. Seguridad Cl√≠nica</h3>
          <p><b>Condiciones de riesgo:</b> ${getChecks('corp_medico[]')}</p>
          <p><b>H√°bitos:</b> Agua: ${data.get('corp_agua')} | Actividad: ${data.get('corp_actividad')} | Digesti√≥n: ${data.get('corp_digestion')}</p>
          <h3>4. Historial M√©dico</h3>
          <p><b>Alergias/Medicamentos:</b> ${data.get('corp_alergias')} / ${data.get('corp_medicamentos')}</p>
          <p><b>Cirug√≠as:</b> ${data.get('corp_cirugias')}</p>
          <p><b>Tensi√≥n:</b> ${data.get('corp_tension')} | <b>FC:</b> ${data.get('corp_fc')}</p>
          <h3>5. Evaluaci√≥n</h3>
          <p><b>Zonas:</b> ${data.get('corp_zonas')}</p>
          <p><b>Diagn√≥stico:</b> ${data.get('corp_diagnostico')}</p>
          <p><b>Dolor/Tensi√≥n:</b> ${data.get('corp_dolor')}</p>
          <h3>6. Protocolo</h3>
          <p>${data.get('corp_recomendacion')}</p>
        `;
      }

      // HTML del PDF
      const html = `
        <html><head><title>${title}</title>
        <style>
          body{ font-family: sans-serif; padding: 30px; color: #333; max-width:800px; margin:0 auto; font-size: 12px; }
          h1{ color: #5b2580; border-bottom: 2px solid #5b2580; padding-bottom: 5px; }
          h3{ background: #f0f0f0; padding: 5px; margin-top: 15px; font-size: 13px; border-left: 4px solid #5b2580; }
          p{ margin: 4px 0; line-height: 1.4; }
          .row{ display: flex; justify-content: space-between; }
          .sig-box{ margin-top: 30px; text-align: center; border: 1px solid #ddd; padding: 10px; width: 50%; }
          .sig-img{ max-width: 200px; max-height: 80px; }
        </style>
        </head><body>
          <h1>${title} - Figura Rostro KG</h1>
          <div class="row">
            <p><b>Cliente:</b> ${type==='facial'?data.get('facial_nombre'):data.get('corp_nombre')}</p>
            <p><b>Fecha:</b> ${new Date().toLocaleDateString()}</p>
          </div>
          <div class="row">
            <p><b>Edad:</b> ${type==='facial'?data.get('facial_edad'):data.get('corp_edad')}</p>
            <p><b>Tel√©fono:</b> ${type==='facial'?data.get('facial_telefono'):data.get('corp_telefono')}</p>
          </div>
          
          ${content}

          <div style="margin-top:40px; display:flex; justify-content:space-between; align-items:flex-end;">
            <div style="text-align:center;">
              <img src="${sigImg}" class="sig-img"><br>
              <div style="border-top:1px solid #000; padding-top:4px; width:200px;">Firma del Cliente</div>
            </div>
            <div style="text-align:center;">
              <div style="border-top:1px solid #000; padding-top:4px; width:200px;">Firma Especialista</div>
            </div>
          </div>
          <p style="font-size:10px; margin-top:20px; color:#666;">Documento generado digitalmente por Figura Rostro KG.</p>
        </body></html>
      `;

      win.document.write(html);
      win.document.close();
      // win.print(); // Descomentar para imprimir directo
    }
  </script>
</body>
</html>
