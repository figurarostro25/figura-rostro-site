<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Agenda tu Cita | Figura Rostro KG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { background-color: #4c1d95; font-family: 'Montserrat', sans-serif; }
        .main-card { background: white; border-radius: 1.5rem; max-width: 500px; margin: auto; overflow: hidden; }
        .header-bg { background: linear-gradient(to bottom, #ffffff, #f3e8ff); padding: 2rem; text-align: center; }
        .input-group { margin-bottom: 1.5rem; padding: 0 2rem; }
        .input-styled { width: 100%; border: 1px solid #e2e8f0; border-radius: 0.75rem; padding: 0.75rem; font-size: 0.9rem; outline: none; }
        .input-styled:focus { border-color: #7c3aed; box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.1); }
        .label-styled { display: block; font-weight: 700; color: #4b5563; font-size: 0.75rem; margin-bottom: 0.5rem; }
        .btn-submit { background-color: #6d28d9; color: white; font-weight: 800; padding: 1rem; border-radius: 1rem; width: 100%; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.2s; }
        .btn-submit:hover { background-color: #5b21b6; transform: translateY(-1px); }
        .promo-banner { background-color: #16a34a; color: white; text-align: center; padding: 0.5rem; font-size: 0.7rem; font-weight: 700; }
        .info-box { background-color: #fffbeb; border: 1px solid #fef3c7; border-radius: 0.75rem; padding: 0.75rem; margin: 1rem 2rem; display: flex; gap: 0.5rem; align-items: start; }
    </style>
</head>
<body class="py-8 px-4">

    <div class="max-w-[500px] mx-auto mb-4">
        <div class="promo-banner rounded-t-lg">
            <i class="fas fa-leaf mr-1"></i> Próxima gira por David Chiriquí y Tierras Altas <span class="ml-2 bg-white text-green-700 px-2 py-0.5 rounded-full text-[9px]">Siguenos para bono de $10</span>
        </div>
    </div>

    <div class="main-card shadow-2xl">
        <div class="header-bg">
            <img src="https://figurarostro.life/logo.png" alt="Logo" class="h-12 mx-auto mb-4"> <div class="inline-block bg-[#d4af37] text-white text-[8px] font-bold px-3 py-1 rounded-full uppercase mb-2">Tratamiento Plasma Fibroblast</div>
            <h1 class="text-2xl font-extrabold text-[#4c1d95]">Agenda tu Cita</h1>
            <p class="text-[10px] text-gray-500 font-medium mt-1">Completa el formulario de pre-evaluación para confirmar disponibilidad.</p>
        </div>

        <form id="formCita" class="pb-8">
            <div class="input-group">
                <label class="label-styled">Nombre Completo</label>
                <input type="text" id="nombre" class="input-styled" placeholder="Nombre y Apellido" required>
            </div>

            <div class="flex px-8 gap-4 mb-6">
                <div class="flex-1">
                    <label class="label-styled">Edad</label>
                    <input type="text" id="edad" class="input-styled" placeholder="Ej: 30">
                </div>
                <div class="flex-1">
                    <label class="label-styled">Ocupación</label>
                    <input type="text" id="ocupacion" class="input-styled" placeholder="Ej: Abogada, Estudiante...">
                </div>
            </div>

            <div class="input-group">
                <label class="label-styled">WhatsApp</label>
                <input type="tel" id="whatsapp" class="input-styled" placeholder="Ej: 6474-8168" required>
            </div>

            <div class="input-group">
                <label class="label-styled">Correo Electrónico</label>
                <input type="email" id="email" class="input-styled" placeholder="Para enviarte la confirmación">
            </div>

            <div class="input-group">
                <label class="label-styled">Provincia</label>
                <select id="provincia" class="input-styled">
                    <option value="" disabled selected>-- Elige una opción --</option>
                    <option>Panamá</option><option>Panamá Oeste</option><option>Chiriquí</option><option>Coclé</option><option>Veraguas</option><option>Colón</option><option>Herrera / Los Santos</option>
                </select>
            </div>

            <div class="input-group">
                <label class="label-styled">¿Qué le inspira a tomar el tratamiento?</label>
                <select id="motivacion" class="input-styled">
                    <option value="" disabled selected>-- Seleccione su motivo principal --</option>
                    <option>Mejorar mi apariencia física</option>
                    <option>Sentirme bien conmigo misma</option>
                    <option>Rejuvenecimiento facial</option>
                    <option>Recomendación</option>
                </select>
            </div>

            <div class="input-group">
                <label class="label-styled">Zona Principal a Tratar</label>
                <select id="zona" class="input-styled">
                    <option value="" disabled selected>-- Seleccione la zona --</option>
                    <option>Párpados (Blefaroplastia)</option>
                    <option>Rostro Completo</option>
                    <option>Abdomen</option>
                    <option>Cuello / Papada</option>
                </select>
            </div>

            <div class="input-group">
                <label class="label-styled">Si pudiera permitírselo, ¿tomaría la promo?</label>
                <select id="toma_promo" class="input-styled">
                    <option value="" disabled selected>-- Seleccione una opción --</option>
                    <option>Si, Definitivamente</option>
                    <option>Tal vez, necesito más info</option>
                </select>
            </div>

            <div class="input-group">
                <label class="label-styled">¿Con cuál medio de pago le gustaría recibir oferta?</label>
                <select id="metodo_pago" class="input-styled">
                    <option value="" disabled selected>-- Preferencia de Pago --</option>
                    <option>Directorio Yappi / Bono de $12</option>
                    <option>Tarjeta de Crédito / ACH</option>
                </select>
            </div>

            <div class="input-group">
                <label class="label-styled">Servicio de Interés</label>
                <select id="servicio" class="input-styled">
                    <option value="" disabled selected>-- Elige una opción --</option>
                    <option>Promo Seguidores Jueves a Domingo $95</option>
                    <option>Valoración Estética - $12.00 (Pago Directo)</option>
                    <option>Valoración Estética - $9.95 (Yappi)</option>
                </select>
            </div>

            <div class="info-box">
                <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                <p class="text-[9px] text-amber-800 font-bold leading-tight">Las Citas Reservadas por Directorio Yappi generan un Bono de Regalo de $12 aplicable a cualquier oferta de la estética.</p>
            </div>

            <div class="input-group">
                <label class="label-styled">Intención de la Visita</label>
                <select id="intencion" class="input-styled">
                    <option value="" disabled selected>-- ¿Qué desea realizar? --</option>
                    <option>Solo Valoración (Diagnóstico)</option>
                    <option>Valoración y Rejuvenecimiento (Mismo día)</option>
                </select>
            </div>

            <div class="mx-8 p-4 border border-purple-100 rounded-xl bg-purple-50/50 mb-6">
                <p class="text-[9px] font-bold text-purple-800 uppercase mb-3 tracking-widest">Seguridad Médica</p>
                <div class="grid grid-cols-2 gap-3 text-[10px] text-gray-600">
                    <label class="flex items-center gap-2"><input type="checkbox" class="med-check" value="Diabetes"> Diabetes</label>
                    <label class="flex items-center gap-2"><input type="checkbox" class="med-check" value="Keloide"> Cicatrización Keloide</label>
                    <label class="flex items-center gap-2"><input type="checkbox" class="med-check" value="Embarazo"> Embarazo</label>
                    <label class="flex items-center gap-2"><input type="checkbox" class="med-check" value="Marcapasos"> Marcapasos</label>
                </div>
            </div>

            <div class="flex px-8 gap-4 mb-6">
                <div class="flex-1">
                    <label class="label-styled">Fecha</label>
                    <input type="date" id="fecha" class="input-styled" required>
                </div>
                <div class="flex-1">
                    <label class="label-styled">Hora</label>
                    <select id="hora" class="input-styled" required>
                        <option value="">Ver Horarios...</option>
                        <option>09:00 AM</option><option>10:00 AM</option><option>11:00 AM</option>
                        <option>01:00 PM</option><option>02:00 PM</option><option>03:00 PM</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label class="label-styled">Observaciones (Opcional)</label>
                <textarea id="obs" rows="2" class="input-styled resize-none" placeholder="¿Algún detalle adicional sobre su cita o zona a tratar?"></textarea>
            </div>

            <div class="px-8">
                <button type="submit" id="btnEnviar" class="btn-submit shadow-xl">Enviar Solicitud Segura</button>
            </div>
        </form>

        <div id="successCard" class="hidden p-12 text-center">
            <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto text-3xl mb-4">
                <i class="fas fa-calendar-check"></i>
            </div>
            <h2 class="text-2xl font-black text-gray-800 uppercase italic">¡Agendado!</h2>
            <p class="text-xs text-gray-500 mt-2">Hemos recibido tu solicitud. Te esperamos el día seleccionado. Por favor llegar 15 minutos antes.</p>
            <button onclick="location.reload()" class="mt-8 text-[10px] font-bold text-gray-400 uppercase underline">Volver al inicio</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBAuTfBKGuG33c9NXc1s0lkQv-7GwA47l0",
            authDomain: "figurarostro-system.firebaseapp.com",
            projectId: "figurarostro-system",
            storageBucket: "figurarostro-system.firebasestorage.app",
            messagingSenderId: "803848354693",
            appId: "1:803848354693:web:7144490abb18b0319822ec"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.getElementById('formCita').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESANDO...';

            const checks = Array.from(document.querySelectorAll('.med-check:checked')).map(c => c.value);
            
            const data = {
                nombre: document.getElementById('nombre').value,
                edad: document.getElementById('edad').value,
                ocupacion: document.getElementById('ocupacion').value,
                whatsapp: document.getElementById('whatsapp').value,
                email: document.getElementById('email').value,
                provincia: document.getElementById('provincia').value,
                motivacion: document.getElementById('motivacion').value,
                zona: document.getElementById('zona').value,
                metodo_pago: document.getElementById('metodo_pago').value,
                toma_promo: document.getElementById('toma_promo').value,
                servicio: document.getElementById('servicio').value,
                intencion: document.getElementById('intencion').value,
                antecedentes: checks,
                fecha_cita: document.getElementById('fecha').value,
                hora_cita: document.getElementById('hora').value,
                observaciones: document.getElementById('obs').value,
                estado: "Pendiente",
                fecha_registro: Timestamp.now()
            };

            try {
                await addDoc(collection(db, "reservas_entrantes"), data);
                document.getElementById('formCita').classList.add('hidden');
                document.getElementById('successCard').classList.remove('hidden');
            } catch (error) {
                alert("Error: " + error.message);
                btn.disabled = false;
                btn.innerText = "Enviar Solicitud Segura";
            }
        });
    </script>
</body>
</html>
